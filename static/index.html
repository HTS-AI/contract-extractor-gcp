<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Invoice to Account Payable Application</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/chatbot.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-page">
        <div class="login-container">
            <div class="login-header">
                <div class="login-icon-wrapper">
                    <span class="login-icon">üîê</span>
                </div>
                <h1>Invoice to Account Payable Application</h1>
                <p>AI-Powered Document Extraction</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="username">üë§ Username</label>
                    <input type="text" id="username" name="username" placeholder="Enter your username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="password">üîë Password</label>
                    <input type="password" id="password" name="password" placeholder="Enter your password" required autocomplete="current-password">
                </div>
                <div id="loginError" class="login-error" style="display: none;"></div>
                <button type="submit" class="login-btn">
                    <span>üöÄ Sign In</span>
                </button>
            </form>
            <div class="login-footer">
                <p>üîí Secure authentication required</p>
            </div>
        </div>
    </div>

    <!-- Main Application (Hidden until login) -->
    <div id="mainApp" class="main-app" style="display: none;">
    <div class="container">
        <header>
            <div class="header-content">
                <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; flex-wrap: wrap; gap: 10px;">
                    <div>
                        <h1><span class="icon">üìÑ</span> Invoice to Account Payable Application</h1>
                        <p>Extract structured information from Invoice</p>
                    </div>
                    <div class="header-buttons">
                        <a href="/dashboard" class="header-btn dashboard-header-btn">
                            <span class="btn-icon">üìä</span>
                            <span>View JSON Dashboard</span>
                        </a>
                        <a href="/selected-factors" class="header-btn factors-header-btn">
                            <span class="btn-icon">üìã</span>
                            <span>Selected Factors</span>
                        </a>
                        <a href="/excel-table" class="header-btn excel-table-btn">
                            <span class="btn-icon">üìä</span>
                            <span>Data Table</span>
                        </a>
                        <button id="fileManagerBtn" class="header-btn" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                            <span class="btn-icon">üóÇÔ∏è</span>
                            <span>Manage Files</span>
                        </button>
                        <button id="logoutBtn" class="header-btn logout-btn">
                            <span class="btn-icon">üö™</span>
                            <span>Logout</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="main-content">
            <!-- Content Layout: Results Left, Upload & Dashboard Right -->
            <div class="content-layout">
                <!-- Results Section - Left Side (Always Visible) -->
                <section id="resultsSection" class="results-section">
                <div class="section-header">
                    <h2>üìã Extracted Information</h2>
                </div>
                
                <div class="results-container" id="resultsContainer">
                    <!-- Extracted Information Cards (Hidden by default) -->
                    <div id="extractedContent" class="extracted-content" style="display: none;">
                    <!-- Basic Info -->
                    <div class="info-card">
                        <div class="card-header">
                            <h3>üìä Basic Information</h3>
                        </div>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Document Title</label>
                                <span id="contractTitle" class="info-value">-</span>
                            </div>
                            <div class="info-item">
                                <label>Document Type</label>
                                <span id="contractType" class="badge">-</span>
                            </div>
                            <div class="info-item">
                                <label>Execution Date</label>
                                <span id="executionDate" class="info-value">-</span>
                            </div>
                            <div class="info-item">
                                <label>Risk Score</label>
                                <span id="riskScore" class="risk-badge">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Invoice Details & Invoice Dates (shown only for invoices) -->
                    <div class="info-card" id="invoiceDetailsCard" style="display: none;">
                        <div class="card-header">
                            <h3>üßæ Invoice Details & Invoice Dates</h3>
                        </div>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Invoice ID</label>
                                <span id="invoiceId" class="info-value badge" style="font-weight: 600; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 4px 10px; border-radius: 6px;">-</span>
                            </div>
                            <div class="info-item">
                                <label>Invoice Type</label>
                                <span id="invoiceType" class="info-value">-</span>
                            </div>
                        </div>
                        
                        <!-- Invoice Dates - Dynamic -->
                        <div id="invoiceDatesSection" style="display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                            <h4 style="color: #2563eb; font-size: 0.95em; font-weight: 600; margin-bottom: 12px;">üìÖ Invoice Dates</h4>
                            <div class="info-grid" id="invoiceDatesGrid">
                                <!-- Date items will be dynamically added here -->
                            </div>
                        </div>
                    </div>

                    <!-- Parties -->
                    <div class="info-card">
                        <div class="card-header">
                            <h3>üë• Parties</h3>
                        </div>
                        <div class="parties-grid">
                            <div class="party-box">
                                <div class="party-header">
                                    <span class="party-icon">üè¢</span>
                                    <h4 id="party1Label">Party 1</h4>
                                </div>
                                <div class="party-content">
                                    <div class="party-field">
                                        <label>Name:</label>
                                        <span id="party1Name">-</span>
                                    </div>
                                    <div class="party-field">
                                        <label>Address:</label>
                                        <span id="party1Address">-</span>
                                    </div>
                                </div>
                            </div>
                            <div class="party-box">
                                <div class="party-header">
                                    <span class="party-icon">ü§ù</span>
                                    <h4 id="party2Label">Party 2</h4>
                                </div>
                                <div class="party-content">
                                    <div class="party-field">
                                        <label>Name:</label>
                                        <span id="party2Name">-</span>
                                    </div>
                                    <div class="party-field">
                                        <label>Address:</label>
                                        <span id="party2Address">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Terms -->
                    <div class="info-card" id="paymentTermsCard" style="display: none;">
                        <div class="card-header">
                            <h3>üí≥ Payment Terms</h3>
                        </div>
                        <div class="info-grid">
                            <div class="info-item" id="paymentTermsItem" style="display: none;">
                                <label>Payment Terms</label>
                                <span id="invoicePaymentTerms" class="info-value" style="background: #f3e8ff; padding: 6px 12px; border-radius: 6px; border-left: 3px solid #7c3aed;">-</span>
                            </div>
                            <div class="info-item" id="paymentMethodItem" style="display: none;">
                                <label>Payment Method</label>
                                <span id="invoicePaymentMethod" class="info-value">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Details -->
                    <div class="info-card">
                        <div class="card-header">
                            <h3>üí∞ Payment Details</h3>
                        </div>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Amount</label>
                                <span id="paymentAmount" class="info-value">-</span>
                                <small id="amountExplanation" style="display: none; color: #6b7280; font-size: 0.75em; margin-top: 4px; font-style: italic;"></small>
                            </div>
                            <div class="info-item">
                                <label>Currency</label>
                                <span id="paymentCurrency" class="info-value">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Amount Breakdown -->
                    <div class="info-card" id="amountBreakdownCard" style="display: none;">
                        <div class="card-header">
                            <h3>üíπ Amount Breakdown</h3>
                        </div>
                        <div class="info-grid" id="taxBreakdownGrid">
                            <!-- Breakdown items will be dynamically added here -->
                        </div>
                    </div>

                    <!-- Vendor/Supplier Tax IDs -->
                    <div class="info-card" id="vendorTaxIdsCard" style="display: none;">
                        <div class="card-header">
                            <h3>üè¢ Vendor/Supplier Tax IDs</h3>
                        </div>
                        <div class="info-grid" id="vendorTaxIdsGrid">
                            <!-- Vendor tax IDs will be dynamically added here -->
                        </div>
                    </div>

                    <!-- Customer/Buyer Tax IDs -->
                    <div class="info-card" id="customerTaxIdsCard" style="display: none;">
                        <div class="card-header">
                            <h3>ü§ù Customer/Buyer Tax IDs</h3>
                        </div>
                        <div class="info-grid" id="customerTaxIdsGrid">
                            <!-- Customer tax IDs will be dynamically added here -->
                        </div>
                    </div>

                    <!-- Bank Details -->
                    <div class="info-card" id="bankDetailsCard" style="display: none;">
                        <div class="card-header">
                            <h3>üè¶ Bank Details</h3>
                        </div>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Bank Name</label>
                                <span id="bankName" class="info-value">-</span>
                            </div>
                            <div class="info-item" style="grid-column: span 2;">
                                <label>Bank Address</label>
                                <span id="invoiceBankAddress" class="info-value" style="word-break: break-word;">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Account Details -->
                    <div class="info-card" id="accountDetailsCard" style="display: none;">
                        <div class="card-header">
                            <h3>üèß Account Details</h3>
                        </div>
                        
                        <!-- Indian Account Format -->
                        <div id="indianAccountDetails" style="display: none;">
                            <div class="info-grid">
                                <div class="info-item">
                                    <label>Name:</label>
                                    <span id="accountHolderName" class="info-value">-</span>
                                </div>
                                <div class="info-item">
                                    <label>Account No:</label>
                                    <span id="accountNumber" class="info-value">-</span>
                                </div>
                                <div class="info-item">
                                    <label>IFSC Code:</label>
                                    <span id="ifscCode" class="info-value">-</span>
                                </div>
                                <div class="info-item">
                                    <label>Branch:</label>
                                    <span id="branch" class="info-value">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- International Account Format -->
                        <div id="internationalAccountDetails" style="display: none;">
                            <div class="info-grid">
                                <div class="info-item">
                                    <label>Account No/IBAN:</label>
                                    <span id="accountNumberIban" class="info-value">-</span>
                                </div>
                                <div class="info-item">
                                    <label>SWIFT Code:</label>
                                    <span id="swiftCode" class="info-value">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bank Address (common for both) -->
                        <div id="bankAddressSection" style="display: none; margin-top: 12px;">
                            <div class="info-item">
                                <label>Bank Address:</label>
                                <span id="bankAddress" class="info-value" style="word-break: break-word;">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Information -->
                    <div class="info-card" id="additionalInfoCard" style="display: none;">
                        <div class="card-header">
                            <h3>üìù Additional Information</h3>
                        </div>
                        <div id="additionalTextContent">
                            <!-- Notes, Declaration, Terms, Remarks will be dynamically added here -->
                        </div>
                    </div>

                    <!-- Deliverables -->
                    <div class="info-card">
                        <div class="card-header">
                            <h3>‚úÖ Deliverables</h3>
                        </div>
                        <ul id="deliverablesList" class="deliverables-list"></ul>
                    </div>

                    <!-- Missing Clauses -->
                    <div class="info-card warning-card" id="missingClausesCard" style="display: none;">
                        <div class="card-header">
                            <h3>‚ö†Ô∏è Missing Clauses</h3>
                        </div>
                        <ul id="missingClausesList" class="missing-list"></ul>
                    </div>
                    </div>
                </div>
                </section>

                <!-- Right Side: Upload & Dashboard -->
                <div class="right-side-panel">
                    <!-- Upload Section - Right Side, Above Dashboard -->
                    <section class="upload-section">
                        <div class="section-header">
                            <h2>üì§ Upload Document</h2>
                        </div>
                        
                        <!-- Document Selector -->
                        <div class="document-selector-container" id="documentSelectorContainer" style="display: none;">
                            <label for="documentSelector" class="selector-label">
                                <span class="selector-icon">üìÅ</span>
                                <span>Or load previous extraction:</span>
                            </label>
                            <select id="documentSelector" class="document-selector">
                                <option value="">Select a document...</option>
                            </select>
                        </div>
                        
                        <div class="upload-container">
                            <div class="upload-left">
                                <input type="file" id="fileInput" accept=".pdf,.docx,.doc" style="display: none;">
                                <label for="fileInput" class="upload-label">
                                    <span class="upload-icon">üìé</span>
                                    <span class="upload-text">
                                        <span id="fileName">Choose file</span>
                                        <small id="fileInfo">PDF or DOCX</small>
                                    </span>
                                </label>
                            </div>
                            <div class="upload-right">
                                <button id="extractBtn" class="btn btn-primary" disabled>
                                    <span class="btn-icon">‚ö°</span>
                                    <span>Extract</span>
                                </button>
                            </div>
                        </div>
                        <div id="uploadStatus" class="status-message"></div>
                    </section>

                    <!-- Dashboard Section - Right Side, Below Upload -->
                    <section class="dashboard-section">
                <div class="section-header">
                    <h2>üìä Dashboard</h2>
                </div>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìÑ</div>
                        <div class="stat-value" id="totalDocuments">0</div>
                        <div class="stat-label">Total Documents</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚ö†Ô∏è</div>
                        <div class="stat-value" id="avgRiskScore">0</div>
                        <div class="stat-label">Avg Risk Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚ùå</div>
                        <div class="stat-value" id="missingClauses">0</div>
                        <div class="stat-label">Missing Clauses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìã</div>
                        <div class="stat-value" id="contractTypes">0</div>
                        <div class="stat-label">Document Types</div>
                    </div>
                </div>

                <!-- Document Types Chart -->
                <div class="chart-card">
                    <h3>Document Types Distribution</h3>
                    <div id="contractTypesChart" class="chart-container"></div>
                </div>
                </section>
                </div>
            </div>
        </div>
    </div>
    </div>
    <!-- End Main App -->

    <!-- Chatbot Button -->
    <button id="chatbot-button" class="chatbot-button" title="Ask questions about your documents">
        <i class="fas fa-comments"></i>
    </button>

    <!-- Chatbot Popup -->
    <div id="chatbot-popup" class="chatbot-popup">
        <!-- Header -->
        <div class="chatbot-header">
            <h3>üìÑ Document Q&A Assistant</h3>
            <button id="chatbot-close" class="chatbot-close">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Body -->
        <div class="chatbot-body">
            <!-- Upload Section -->
            <div id="upload-section" class="chatbot-upload">
                <div class="upload-icon">üìÅ</div>
                <h4>Upload a Document</h4>
                <p>Ask questions about any PDF, DOCX, or TXT file</p>
                <button id="upload-doc-button" class="upload-button">
                    <i class="fas fa-upload"></i> Choose File
                </button>
                <input type="file" id="chat-file-input" class="file-input-hidden" accept=".pdf,.docx,.txt">
            </div>

            <!-- Loading Section -->
            <div id="loading-section" class="chatbot-loading" style="display: none;">
                <div class="spinner"></div>
                <p class="loading-text">Processing your document...</p>
            </div>

            <!-- Chat Section -->
            <div id="chat-section" style="display: none; flex-direction: column; height: 100%;">
                <!-- Document Info -->
                <div id="document-info" class="document-info">
                    <div class="document-info-title">üìÑ Current Document:</div>
                    <div id="document-filename" class="document-info-filename">-</div>
                    <button id="change-document" class="change-document-btn">
                        <i class="fas fa-sync-alt"></i> Change Document
                    </button>
                </div>

                <!-- Messages -->
                <div id="chat-messages" class="chat-messages"></div>
            </div>
        </div>

        <!-- Footer (Input) -->
        <div class="chatbot-footer">
            <div class="chat-input-container">
                <input 
                    type="text" 
                    id="chat-input" 
                    class="chat-input" 
                    placeholder="Ask a question about the document..."
                    disabled
                >
                <button id="send-button" class="send-button" disabled>
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Duplicate Invoice Warning Modal -->
    <div id="duplicateWarningModal" class="duplicate-modal-overlay" style="display: none;">
        <div class="duplicate-modal-container">
            <div class="duplicate-modal-header">
                <div class="duplicate-warning-icon">‚ö†Ô∏è</div>
                <h2 class="duplicate-modal-title">DUPLICATE INVOICE DETECTED</h2>
                <button id="closeDuplicateModal" class="duplicate-modal-close">&times;</button>
            </div>
            
            <div class="duplicate-modal-body">
                <div class="duplicate-invoice-id">
                    <label>Invoice ID:</label>
                    <span id="duplicateInvoiceId" class="duplicate-value"></span>
                </div>
                
                <div class="duplicate-message">
                    <p><strong>This invoice already exists in the system:</strong></p>
                </div>
                
                <div class="duplicate-details">
                    <div class="duplicate-detail-item">
                        <span class="detail-icon">üìÑ</span>
                        <div class="detail-content">
                            <label>Existing File:</label>
                            <span id="duplicateExistingFile" class="detail-value"></span>
                        </div>
                    </div>
                    
                    <div class="duplicate-detail-item" id="duplicateVendorItem" style="display: none;">
                        <span class="detail-icon">üè¢</span>
                        <div class="detail-content">
                            <label>Vendor:</label>
                            <span id="duplicateVendor" class="detail-value"></span>
                        </div>
                    </div>
                    
                    <div class="duplicate-detail-item" id="duplicateAmountItem" style="display: none;">
                        <span class="detail-icon">üí∞</span>
                        <div class="detail-content">
                            <label>Amount:</label>
                            <span id="duplicateAmount" class="detail-value"></span>
                        </div>
                    </div>
                    
                    <div class="duplicate-detail-item">
                        <span class="detail-icon">üìÖ</span>
                        <div class="detail-content">
                            <label>Processed Date:</label>
                            <span id="duplicateProcessedDate" class="detail-value"></span>
                        </div>
                    </div>
                </div>
                
                <div class="duplicate-alert-box">
                    <strong>‚ö†Ô∏è Important:</strong> The duplicate invoice was not saved to the database.
                    <br>
                    Please verify you uploaded the correct document.
                </div>
            </div>
            
            <div class="duplicate-modal-footer">
                <button id="duplicateModalOkBtn" class="duplicate-ok-btn">
                    <span>OK</span>
                </button>
            </div>
        </div>
    </div>

    <!-- File Manager Modal -->
    <div id="fileManagerModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px; max-height: 85vh; overflow: hidden; display: flex; flex-direction: column;">
            <div class="modal-header" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 20px; border-radius: 12px 12px 0 0;">
                <h2 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                    <span>üóÇÔ∏è</span>
                    <span>File & Cache Manager</span>
                </h2>
                <button id="closeFileManagerBtn" style="background: rgba(255,255,255,0.2); border: none; color: white; font-size: 24px; cursor: pointer; padding: 5px 10px; border-radius: 6px;">&times;</button>
            </div>
            
            <div style="padding: 15px; background: #fef2f2; border-bottom: 1px solid #fecaca;">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                    <div>
                        <span id="gcsStatusBadge" style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 0.8em; font-weight: 600;"></span>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button id="refreshFilesBtn" class="file-mgr-btn" style="background: #3b82f6;">üîÑ Refresh</button>
                        <button id="selectAllFilesBtn" class="file-mgr-btn" style="background: #8b5cf6;">‚òëÔ∏è Select All</button>
                        <button id="deselectAllFilesBtn" class="file-mgr-btn" style="background: #6b7280;">‚òê Deselect All</button>
                        <button id="deleteSelectedBtn" class="file-mgr-btn" style="background: #ef4444;">üóëÔ∏è Delete Selected</button>
                    </div>
                </div>
            </div>
            
            <div style="padding: 15px; overflow-y: auto; flex: 1;">
                <!-- File Categories Tabs -->
                <div style="display: flex; gap: 5px; margin-bottom: 15px; flex-wrap: wrap;">
                    <button class="file-tab active" data-tab="extractions">üìÑ Extractions <span id="extractionsCount" class="tab-count">0</span></button>
                    <button class="file-tab" data-tab="extraction_cache">üì¶ Extraction Cache <span id="extractionCacheCount" class="tab-count">0</span></button>
                    <button class="file-tab" data-tab="chatbot_cache">üí¨ Chatbot Cache <span id="chatbotCacheCount" class="tab-count">0</span></button>
                    <button class="file-tab" data-tab="exports">üìä Exports <span id="exportsCount" class="tab-count">0</span></button>
                </div>
                
                <!-- Loading State -->
                <div id="fileManagerLoading" style="text-align: center; padding: 40px;">
                    <div class="loading-spinner"></div>
                    <p>Loading files...</p>
                </div>
                
                <!-- Delete Progress Section -->
                <div id="deleteProgressSection" style="display: none; padding: 20px; background: #fef3c7; border-radius: 8px; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div class="loading-spinner" style="width: 20px; height: 20px; border-width: 2px;"></div>
                        <span id="deleteProgressTitle" style="font-weight: 600; color: #92400e;">Deleting files...</span>
                    </div>
                    <div style="background: #fde68a; border-radius: 4px; height: 8px; overflow: hidden;">
                        <div id="deleteProgressBar" style="background: linear-gradient(90deg, #f59e0b, #d97706); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.85em; color: #78350f;">
                        <span id="deleteProgressText">0 of 0 files</span>
                        <span id="deleteProgressPercent">0%</span>
                    </div>
                    <div id="deleteProgressDetails" style="margin-top: 10px; font-size: 0.8em; color: #92400e; max-height: 100px; overflow-y: auto;"></div>
                </div>
                
                <!-- Files Table -->
                <div id="filesTableContainer" style="display: none;">
                    <table class="files-table" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f3f4f6;">
                                <th style="width: 40px; padding: 10px;"><input type="checkbox" id="selectAllCheckbox"></th>
                                <th style="padding: 10px; text-align: left;">File Name</th>
                                <th style="padding: 10px; text-align: left;">Original Document</th>
                                <th style="padding: 10px; text-align: center;">Location</th>
                                <th style="padding: 10px; text-align: right;">Size</th>
                                <th style="padding: 10px; text-align: center;">Modified</th>
                                <th style="padding: 10px; text-align: center;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="filesTableBody">
                            <!-- Files will be populated here -->
                        </tbody>
                    </table>
                    
                    <div id="noFilesMessage" style="display: none; text-align: center; padding: 40px; color: #6b7280;">
                        <p style="font-size: 3em; margin-bottom: 10px;">üì≠</p>
                        <p>No files in this category</p>
                    </div>
                </div>
            </div>
            
            <div style="padding: 15px; border-top: 1px solid #e5e7eb; background: #f9fafb; border-radius: 0 0 12px 12px;">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                    <div style="color: #6b7280; font-size: 0.9em;">
                        <span id="selectedCount">0</span> files selected
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button id="clearAllCacheBtn" class="file-mgr-btn" style="background: #f59e0b;">‚ö†Ô∏è Clear All Cache</button>
                        <button id="clearEverythingBtn" class="file-mgr-btn" style="background: #dc2626;">üî• Clear Everything</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Confirm Delete Modal -->
    <div id="confirmDeleteModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 450px; text-align: center;">
            <div style="padding: 30px;">
                <div style="font-size: 4em; margin-bottom: 15px;">‚ö†Ô∏è</div>
                <h3 id="confirmDeleteTitle" style="margin-bottom: 10px; color: #dc2626;">Confirm Deletion</h3>
                <p id="confirmDeleteMessage" style="color: #6b7280; margin-bottom: 20px;"></p>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button id="cancelDeleteBtn" class="file-mgr-btn" style="background: #6b7280; padding: 10px 25px;">Cancel</button>
                    <button id="confirmDeleteBtn" class="file-mgr-btn" style="background: #dc2626; padding: 10px 25px;">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* Modal Base Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(4px);
        }
        .modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            width: 90%;
            position: relative;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* File Manager Styles */
        .file-mgr-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s;
        }
        .file-mgr-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        .file-mgr-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .file-tab {
            padding: 8px 16px;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
        }
        .file-tab:hover {
            background: #f3f4f6;
        }
        .file-tab.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .tab-count {
            display: inline-block;
            background: rgba(0,0,0,0.1);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.8em;
            margin-left: 5px;
        }
        .file-tab.active .tab-count {
            background: rgba(255,255,255,0.2);
        }
        .files-table tbody tr {
            border-bottom: 1px solid #e5e7eb;
            transition: background 0.2s;
        }
        .files-table tbody tr:hover {
            background: #f9fafb;
        }
        .files-table td {
            padding: 12px 10px;
        }
        .location-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
        }
        .location-local {
            background: #dbeafe;
            color: #1e40af;
        }
        .location-gcs {
            background: #fef3c7;
            color: #92400e;
        }
        .delete-single-btn {
            background: #fee2e2;
            color: #dc2626;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
        }
        .delete-single-btn:hover {
            background: #fecaca;
        }
        #fileManagerModal .modal-content {
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>

    <script src="/static/script.js"></script>
    <script src="/static/chatbot.js"></script>
</body>
</html>
